name: ğŸš€ Deploy NEXUS Intelligence System

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy-railway:
    name: ğŸš„ Deploy to Railway
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: ğŸ”½ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
          
      - name: ğŸ“¦ Install Railway CLI
        run: |
          curl -fsSL https://railway.app/install.sh | sh
          echo "$HOME/.railway/bin" >> $GITHUB_PATH
          
      - name: ğŸš„ Deploy to Railway
        run: railway up --service nexus-intelligence
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

  deploy-render:
    name: ğŸ¨ Deploy to Render
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: ğŸ”½ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ¨ Deploy to Render
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: ğŸ“¡ Trigger Render Deployment
        run: |
          curl -X POST "https://api.render.com/deploy/srv-${{ secrets.RENDER_SERVICE_ID }}" \
            -H "Authorization: Bearer ${{ secrets.RENDER_API_KEY }}"

  health-check:
    name: ğŸ” Health Check Deployments
    runs-on: ubuntu-latest
    needs: [deploy-railway, deploy-render]
    if: always()
    
    steps:
      - name: ğŸ” Check Railway Deployment
        run: |
          echo "Checking Railway deployment health..."
          # Add Railway health check URL when available
          
      - name: ğŸ” Check Render Deployment  
        run: |
          echo "Checking Render deployment health..."
          # Add Render health check URL when available
          
      - name: ğŸ“§ Notify Success
        if: success()
        run: |
          echo "ğŸš€ NEXUS Intelligence System deployed successfully!"
          echo "All health checks passed âœ…"
          
      - name: ğŸš¨ Notify Failure
        if: failure()
        run: |
          echo "âŒ NEXUS deployment failed!"
          echo "Check the logs for details"